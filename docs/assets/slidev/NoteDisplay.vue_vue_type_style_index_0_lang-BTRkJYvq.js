import{d as E,y as B,t as b,D as H,n as N,ac as $,C as I,o as d,b as k,i as v,e as M,x as S}from"../modules/vue-DQa2LXgQ.js";import{C as P}from"../index-IRPrl4M6.js";const T=["innerHTML"],K=["textContent"],R=["textContent"],h="slidev-note-fade",r="slidev-note-click-mark",z=E({__name:"NoteDisplay",props:{class:{},noteHtml:{},note:{},highlight:{type:Boolean,default:!0},placeholder:{},clicksContext:{},autoScroll:{type:Boolean}},emits:["markerDblclick","markerClick"],setup(A,{emit:D}){const n=A,g=D,C=B(()=>{var a;return n.clicksContext!=null&&((a=n.noteHtml)==null?void 0:a.includes("slidev-note-click-mark"))}),p=b(null);function y(){var w,L;if(!p.value||!C.value)return;const a=Array.from(p.value.querySelectorAll(`.${r}`)),c=new Map,i=new Map;let x=0;for(const s of a){const o=Number(s.dataset.clicks);c.set(s,o);let t=s,e=s.parentElement;for(;e&&t!==p.value;)i.has(e)||i.set(e,[[null,x]]),i.get(e).push([t,o]),t=e,e=e.parentElement;x=o}const _=new Map;for(const[s,o]of i){let t=!1,e=0;for(const l of Array.from(s.childNodes)){let f=!1;for(;l===((w=o[e+1])==null?void 0:w[0]);)f=!0,e++;if(f)continue;let u=l;if(l.nodeType===3){if(!((L=l.textContent)!=null&&L.trim()))continue;u=document.createElement("span"),u.textContent=l.textContent,s.insertBefore(u,l),l.remove()}t||(t=e===0),_.set(u,o[e][1])}t||(o[0][1]=-1)}return s=>{const o=n.highlight;for(const[t,e]of i)t.classList.toggle(h,o&&!e.some(([l,f])=>f===s));for(const[t,e]of _)t.classList.toggle(h,o&&e!==s);for(const[t,e]of c)t.classList.remove(h),t.classList.toggle(`${r}-past`,o&&e<s),t.classList.toggle(`${r}-active`,o&&e===s),t.classList.toggle(`${r}-next`,o&&e===s+1),t.classList.toggle(`${r}-future`,o&&e>s+1),t.ondblclick=o?l=>{g("markerDblclick",l,e),!l.defaultPrevented&&(n.clicksContext.current=e,l.stopPropagation(),l.stopImmediatePropagation())}:null,t.onclick=o?l=>{g("markerClick",l,e)}:null,o&&n.autoScroll&&e===s&&t.scrollIntoView({block:"center",behavior:"smooth"})}}const m=b();return H(()=>[n.noteHtml,n.highlight],()=>{N(()=>{m.value=y()})},{immediate:!0}),$(()=>{y()}),I(()=>{var c,i;const a=((c=n.clicksContext)==null?void 0:c.current)??P;(i=m.value)==null||i.call(m,a)}),(a,c)=>a.noteHtml?(d(),k("div",{key:0,ref_key:"noteDisplay",ref:p,class:v(["prose overflow-auto outline-none slidev-note",[n.class,C.value?"slidev-note-with-clicks":""]]),innerHTML:a.noteHtml},null,10,T)):a.note?(d(),k("div",{key:1,class:v(["prose overflow-auto outline-none slidev-note",n.class])},[M("p",{textContent:S(a.note)},null,8,K)],2)):(d(),k("div",{key:2,class:v(["prose overflow-auto outline-none opacity-50 italic select-none slidev-note",n.class])},[M("p",{textContent:S(n.placeholder||"No notes.")},null,8,R)],2))}});export{z as _};
